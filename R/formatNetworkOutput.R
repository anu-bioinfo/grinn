#' \code{formatNetworkOutput} format resulting network
#'@description Format network output for further uses by \code{fetchGrinnNetwork}. Retrieve also node relationships using \code{fetchNodeRelation}.
#'@seealso \code{fetchGrinnNetwork}, \code{fetchNodeRelation}
#'#querystring="UNWIND ['G371','G783'] AS x WITH x MATCH ptw = (from:Metabolite)<-[rel:MAP_TO]-(to:Pathway) 
#'#WHERE lower(from.GID) = lower(x) RETURN DISTINCT ptw"
#'#network = curlRequestCypher(querystring)
#'#formatNetworkOutput(network,returnAs="tab")

formatNetworkOutput <- function(network,returnAs){
  pair = data.frame() #list of mapped nodes
  attb = data.frame() #list of node attributes
  if(length(network)<10000){
    cat("Formating and returning network of size", length(network),"...\n")
    pair = data.frame(t(sapply(network, function(x) fetchRelation.TRANSACTION(x))))
    attbs = data.frame(t(sapply(network, function(x) fetchNode.TRANSACTION(x$graph$nodes[[1]]))))
    attbt = data.frame(t(sapply(network, function(x) fetchNode.TRANSACTION(x$graph$nodes[[2]]))))
    attb = unique(rbind(attbs,attbt))
  }else{
    cat("Found ",length(network)," but returning network of size 10000...\n")
    pair = data.frame(t(sapply(network[1:10000], function(x) fetchRelation.TRANSACTION(x))))
    attbs = data.frame(t(sapply(network[1:10000], function(x) fetchNode.TRANSACTION(x$graph$nodes[[1]]))))
    attbt = data.frame(t(sapply(network[1:10000], function(x) fetchNode.TRANSACTION(x$graph$nodes[[2]]))))
    attb = unique(rbind(attbs,attbt))
  }

  out = switch(returnAs,
                  tab = list(nodes=attb, edges=pair),
                  json = list(nodes=jsonlite::toJSON(attb), edges=jsonlite::toJSON(pair)),
                  cytoscape = createCyNetwork(attb, pair),
                  stop("incorrect return type"))
}